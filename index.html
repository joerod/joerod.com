<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JoeRod.com</title>

  <!-- Inline SVG favicon: solid deep blue JR (diagonal). -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3Cfilter id='s' x='-20%25' y='-20%25' width='140%25' height='140%25'%3E%3CfeDropShadow dx='0' dy='1' stdDeviation='1' flood-color='black' flood-opacity='0.55'/%3E%3C/filter%3E%3C/defs%3E%3Crect width='64' height='64' fill='none'/%3E%3Cpath d='M18 10 q8 0 8 8 v13 q0 6 -4 9 t-9 2 q-3 0 -6 -1 l2 -6 q2 1 4 1 q3 0 4.5 -1.5 t1.5 -4.5 v-12 q0 -1.8 -1 -2.9 t-3 -1.1 h-2 v-4 h5z' fill='%231e3a8a' filter='url(%23s)'/%3E%3Cpath d='M31 28 h8 q8 0 8 8 q0 5 -4 7 l6 9 h-8 l-5 -8 h-3 v8 h-6 v-24 z m6 5 v7 h3 q3 0 3 -3 q0 -4 -3 -4 h-3z' fill='%231e3a8a' filter='url(%23s)'/%3E%3C/svg%3E" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap');

    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-color: #f093fb;
      --text-color: #ffffff;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --live-score-color: #86efac; /* pale green for live scores */
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(-45deg, #1e3a8a, #3b82f6, #60a5fa, #93c5fd);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      color: var(--text-color);
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      padding-top: 80px;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .fixed-header {
      position: fixed; top: 0; left: 0; right: 0;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 1000; padding: 15px 20px;
      display: flex; justify-content: center; align-items: center;
    }

    .site-title {
      font-family: 'Dancing Script', cursive;
      font-size: 2.5rem;
      font-weight: 700;
      color: #ffffff;
      text-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
      letter-spacing: 0.5px;
      animation: titleColorShift 15s ease infinite;
    }

    @keyframes titleColorShift {
      0%   { color: #1e3a8a; text-shadow: 0 2px 15px rgba(255,255,255,0.4); }
      25%  { color: #ffffff; text-shadow: 0 2px 15px rgba(0,0,0,0.4); }
      50%  { color: #1e3a8a; text-shadow: 0 2px 15px rgba(255,255,255,0.4); }
      75%  { color: #ffffff; text-shadow: 0 2px 15px rgba(0,0,0,0.4); }
      100% { color: #1e3a8a; text-shadow: 0 2px 15px rgba(255,255,255,0.4); }
    }

    .glass { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 20px; }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 1rem;
      min-height: 0;
    }

    .weather-widget {
      position: fixed;
      top: 95px;
      right: 15px;
      padding: 1rem;
      border-radius: 12px;
      backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-width: 220px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      max-height: calc(100vh - 110px);
      overflow-y: auto;
    }

    .ny-time {
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.2px;
      margin-bottom: 0.4rem;
      opacity: 0.95;
    }

    .weather-icon { font-size: 2rem; margin-bottom: 0.3rem; display: block; }
    .weather-temp { font-size: 2rem; font-weight: 600; margin-bottom: 0.5rem; }
    .weather-desc { font-size: 0.85rem; opacity: 0.9; text-transform: capitalize; }

    .bitcoin-price {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
    }
    .bitcoin-price-title {
      font-size: 0.7rem;
      opacity: 0.8;
      margin-bottom: 0.4rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
    }
    .bitcoin-price-title img { width: 12px; height: 12px; filter: brightness(0) invert(1); }
    .bitcoin-price-value { font-size: 0.8rem; font-weight: 600; color: #fbbf24; }

    /* Stocks */
    .stocks {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
    }
    .stocks-title {
      font-size: 0.7rem;
      opacity: 0.8;
      margin-bottom: 0.4rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
    }
    .stocks-title .icon {
      width: 13px; height: 13px; display: inline-block;
      filter: brightness(0) invert(1);
    }
    .stock-row {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.72rem;
      padding: 0.18rem 0;
    }
    .stock-name { opacity: 0.95; }
    .stock-value { font-weight: 600; text-align: right; }
    .stock-change { font-size: 0.68rem; opacity: 0.9; text-align: right; }
    .up { color: #a7f3d0; }
    .down { color: #fecaca; }

    .sports-scores {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      text-align: left;
    }
    .sports-title {
      font-size: 0.7rem;
      opacity: 0.8;
      margin-bottom: 0.4rem;
      font-weight: 600;
      text-align: center;
      width: 100%;
    }

    .scores-scroll {
      max-height: 240px;
      overflow-y: auto;
      overscroll-behavior: contain;
      padding-right: 6px;
    }
    .scores-scroll::-webkit-scrollbar { width: 8px; }
    .scores-scroll::-webkit-scrollbar-track { background: rgba(255,255,255,0.08); border-radius: 8px; }
    .scores-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.25); border-radius: 8px; }
    .scores-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.35); }

    .league-block { margin-bottom: 0.5rem; }
    .league-name { font-size: 0.7rem; opacity: 0.85; margin: 0.4rem 0 0.2rem; font-weight: 600; }

    .game-line { display: flex; justify-content: space-between; gap: 0.6rem; padding: 0.2rem 0; }
    .game-left { display:flex; gap:0.5rem; align-items:flex-start; min-width:0; }
    .team-col { display:flex; flex-direction:column; min-width:0; }
    .team-main { font-size: 0.65rem; line-height: 1.15; white-space: nowrap; }
    .team-sub { font-size: 0.6rem; opacity: 0.78; line-height: 1.1; white-space: nowrap; margin-top: -1px; }
    .at { opacity: 0.8; font-size: 0.65rem; padding: 0 2px; align-self: center; }
    .game-status { opacity: 0.85; font-size: 0.6rem; white-space: nowrap; align-self: center; }

    /* In-progress: only the numeric score turns green */
    .game-line.live .score { color: var(--live-score-color); font-weight: 800; }

    /* Fade animation for score updates */
    .score { transition: opacity 180ms ease; }
    .score-updating { opacity: 0.2; }

    .video-container {
      width: 100%;
      max-width: 600px;
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      padding-bottom: 33.75%;
      height: 0;
    }
    .video-container:hover { transform: translateY(-5px); box-shadow: 0 20px 50px rgba(0,0,0,0.4); }
    .video iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    /* "Next Video" link and video title */
    .video-controls {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 6px auto;
      text-align: left;
      font-size: 0.95rem;
    }
    .video-controls a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }
    .video-controls a:hover { text-decoration: underline; }

    .video-title {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 12px auto;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      opacity: 0.9;
    }

    footer {
      padding: 2rem;
      text-align: center;
      backdrop-filter: blur(20px);
      background: rgba(0, 0, 0, 0.1);
      margin-top: auto;
    }

    .social-links {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.2rem;
      flex-wrap: wrap;
    }
    .social-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: var(--text-color);
      text-decoration: none;
      padding: 0.45rem 0.75rem;
      border-radius: 50px;
      backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      font-size: 0.85rem;
    }
    .social-link:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
    .social-link img { width: 16px; height: 16px; filter: brightness(0) invert(1); }

    @media (max-width: 768px) {
      body { padding-top: 70px; overflow-y: auto; height: auto; min-height: 100vh; }
      .fixed-header { padding: 10px 15px; }
      .site-title { font-size: 2rem; }
      .weather-widget { position: static; margin: 1rem auto; width: 100%; max-width: 300px; max-height: none; order: -1; }
      main { padding: 0.5rem; order: 0; }
      .video-container { margin: 0.6rem 0; max-width: 100%; padding-bottom: 56.25%; }
      .video-controls { max-width: 100%; }
      .social-links { gap: 0.45rem; }
      .social-link { font-size: 0.85rem; padding: 0.45rem 0.75rem; }
      .scores-scroll { max-height: 220px; }
      footer { padding: 1.5rem 1rem; }
    }

    @media (max-width: 480px) {
      body { padding-top: 65px; }
      .fixed-header { padding: 8px 12px; }
      .site-title { font-size: 1.8rem; }
      .weather-widget { margin: 0.8rem auto; max-width: 95%; padding: 0.8rem; }
      .social-link { font-size: 0.82rem; padding: 0.4rem 0.7rem; }
      footer { padding: 1rem 0.5rem; }
    }

    @media (max-width: 768px) and (orientation: landscape) {
      body { padding-top: 60px; }
      .fixed-header { padding: 8px 15px; }
      .site-title { font-size: 1.8rem; }
      .weather-widget { position: fixed; top: 70px; right: 10px; margin: 0; max-width: 220px; font-size: 0.8rem; }
      .video-container { max-width: 70%; margin: 0.5rem auto; }
      .scores-scroll { max-height: 160px; }
    }

    @media (hover: none) and (pointer: coarse) {
      .social-link:hover { background: rgba(255, 255, 255, 0.1); transform: none; box-shadow: none; }
      .social-link:active { background: rgba(255, 255, 255, 0.3); transform: scale(0.98); }
    }

    .loading { color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; }
  </style>

  <script>
    // Festive color tweak in December
    document.addEventListener("DOMContentLoaded", () => {
      const now = new Date();
      if (now.getMonth() === 11) {
        document.documentElement.style.setProperty('--primary-color', '#dc2626');
        document.documentElement.style.setProperty('--secondary-color', '#166534');
        document.documentElement.style.setProperty('--accent-color', '#fbbf24');
      }
    });

    function yyyymmdd(date = new Date()) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}${m}${d}`;
    }

    // NYC time (24h) ‚Äî no seconds
    function updateNYTime() {
      try {
        const opts = {
          timeZone: 'America/New_York',
          weekday: 'short',
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        };
        const nowStr = new Intl.DateTimeFormat('en-US', opts).format(new Date());
        const el = document.getElementById('ny-time');
        if (el) el.textContent = `NYC ‚Ä¢ ${nowStr}`;
      } catch (e) {
        const el = document.getElementById('ny-time');
        if (el) el.textContent = 'NYC ‚Ä¢ Time unavailable';
      }
    }

    // Weather function using OpenWeatherMap API
    async function loadWeather() {
      try {
        const API_KEY = 'ea033866cb220b2bb944e00b54306c14';
        const url = `https://api.openweathermap.org/data/2.5/weather?q=New York,NY,US&appid=${API_KEY}&units=imperial`;

        const response = await fetch(url, { cache: 'no-store', mode: 'cors' });
        const data = await response.json();

        if (data.cod === 200) {
          // Update weather icon
          const iconCode = data.weather[0].icon;
          const iconMap = {
            '01d': '‚òÄÔ∏è', '01n': 'üåô', '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
            '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è', '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
            '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è', '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
            '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è', '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
            '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
          };
          document.getElementById('weather-icon').textContent = iconMap[iconCode] || 'üå§Ô∏è';

          // Update temperature
          const temp = Math.round(data.main.temp);
          document.getElementById('weather-temp').textContent = `${temp}¬∞F`;

          // Update description
          document.getElementById('weather-desc').textContent = data.weather[0].description;

        } else {
          throw new Error('Weather API returned error');
        }
      } catch (error) {
        console.error('Weather loading error:', error);
        document.getElementById('weather-icon').textContent = 'üå§Ô∏è';
        document.getElementById('weather-temp').textContent = 'Weather unavailable';
        document.getElementById('weather-desc').textContent = 'Unable to load weather';
      }
    }

    // Bitcoin price (CoinGecko)
    async function loadBitcoinPrice() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd', { cache: 'no-store', mode: 'cors' });
        const data = await response.json();
        const price = data?.bitcoin?.usd;
        document.getElementById('bitcoin-price-value').textContent =
          price ? new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(price)
                : 'Price unavailable';
      } catch (error) {
        console.error('Bitcoin price loading error:', error);
        const el = document.getElementById('bitcoin-price-value');
        if (el) el.textContent = 'Price unavailable';
      }
    }

    // ---- Individual Stocks (AAPL, AMZN, TSLA, MSFT) ----
    let stocksTimer = null;
    const FMP_KEY = '7GnhMIdkPTdqlFXV4cUaKgUK8cPFNXXg';

    function isMarketOpenNY() {
      // Approximation: Mon‚ÄìFri, 9:30-16:00 ET
      const now = new Date();
      const ny = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
      const day = ny.getDay(); // 0 Sun ... 6 Sat
      const hours = ny.getHours();
      const minutes = ny.getMinutes();
      const afterOpen = (hours > 9 || (hours === 9 && minutes >= 30));
      const beforeClose = (hours < 16 || (hours === 16 && minutes <= 5));
      const isWeekday = day >= 1 && day <= 5;
      return isWeekday && afterOpen && beforeClose;
    }

    async function loadStocks() {
      const el = document.getElementById('stocks-body');
      if (!el) return;
      el.innerHTML = '<div class="stock-row"><span class="stock-name">Loading...</span><span class="stock-value"></span><span class="stock-change"></span></div>';

      const render = (rows) => {
        el.innerHTML = '';
        rows.forEach(r => {
          const row = document.createElement('div');
          row.className = 'stock-row';
          const chgClass = (r.changePercent ?? 0) >= 0 ? 'up' : 'down';
          const pct = (r.changePercent != null) ? `${(r.changePercent).toFixed(2)}%` : '';
          row.innerHTML = `
            <span class="stock-name">${r.name}</span>
            <span class="stock-value">$${r.price != null ? r.price.toFixed(2) : '‚Äî'}</span>
            <span class="stock-change ${chgClass}">${pct}</span>
          `;
          el.appendChild(row);
        });
      };

      // Try multiple real data sources in order
      const dataSources = [
        // Primary: Financial Modeling Prep
        async () => {
          const symbols = 'AAPL,AMZN,TSLA,MSFT';
          const url = `https://financialmodelingprep.com/api/v3/quote/${symbols}?apikey=${encodeURIComponent(FMP_KEY)}`;
          const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
          if (!res.ok) throw new Error('FMP failed');
          const data = await res.json();
          const nameMap = {
            'AAPL': 'Apple',
            'AMZN': 'Amazon',
            'TSLA': 'Tesla',
            'MSFT': 'Microsoft'
          };
          return data
            .filter(x => nameMap[x.symbol])
            .map(x => ({
              name: nameMap[x.symbol],
              price: x.price ?? x.previousClose ?? x.prevClose ?? null,
              changePercent: x.changesPercentage != null ? parseFloat(x.changesPercentage) : null
            }))
            .sort((a, b) => {
              // Order: Apple, Amazon, Tesla, Microsoft
              const order = ['Apple', 'Amazon', 'Tesla', 'Microsoft'];
              return order.indexOf(a.name) - order.indexOf(b.name);
            });
        },

        // Backup 1: Yahoo Finance
        async () => {
          const symbols = ['AAPL', 'AMZN', 'TSLA', 'MSFT'];
          const results = [];

          for (const symbol of symbols) {
            try {
              const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;
              const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
              if (!res.ok) continue;
              const data = await res.json();

              if (data.chart && data.chart.result && data.chart.result[0]) {
                const result = data.chart.result[0];
                const meta = result.meta;
                const current = meta.regularMarketPrice || meta.previousClose;
                const prev = meta.previousClose;
                const change = current && prev ? ((current - prev) / prev) * 100 : null;

                const nameMap = {
                  'AAPL': 'Apple',
                  'AMZN': 'Amazon',
                  'TSLA': 'Tesla',
                  'MSFT': 'Microsoft'
                };
                results.push({
                  name: nameMap[symbol] || symbol,
                  price: current,
                  changePercent: change
                });
              }
            } catch (e) {
              console.log(`Yahoo Finance failed for ${symbol}:`, e);
              continue;
            }
          }

          if (results.length === 0) throw new Error('Yahoo Finance failed');

          // Sort in desired order
          const order = ['Apple', 'Amazon', 'Tesla', 'Microsoft'];
          results.sort((a, b) => order.indexOf(a.name) - order.indexOf(b.name));

          return results;
        },

        // Backup 2: Alpha Vantage (free tier)
        async () => {
          const symbols = ['AAPL', 'AMZN', 'TSLA', 'MSFT'];
          const results = [];

          for (const symbol of symbols) {
            try {
              const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=demo`;
              const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
              if (!res.ok) continue;
              const data = await res.json();

              if (data['Global Quote']) {
                const quote = data['Global Quote'];
                const current = parseFloat(quote['05. price']);
                const changePercent = parseFloat(quote['10. change percent'].replace('%', ''));

                const nameMap = {
                  'AAPL': 'Apple',
                  'AMZN': 'Amazon',
                  'TSLA': 'Tesla',
                  'MSFT': 'Microsoft'
                };
                results.push({
                  name: nameMap[symbol] || symbol,
                  price: current,
                  changePercent: changePercent
                });
              }
            } catch (e) {
              console.log(`Alpha Vantage failed for ${symbol}:`, e);
              continue;
            }
          }

          if (results.length === 0) throw new Error('Alpha Vantage failed');

          // Sort in desired order
          const order = ['Apple', 'Amazon', 'Tesla', 'Microsoft'];
          results.sort((a, b) => order.indexOf(a.name) - order.indexOf(b.name));

          return results;
        },

        // Backup 3: IEX Cloud (free tier)
        async () => {
          const symbols = ['AAPL', 'AMZN', 'TSLA', 'MSFT'];
          const results = [];

          for (const symbol of symbols) {
            try {
              const url = `https://cloud.iexapis.com/stable/stock/${symbol}/quote?token=demo`;
              const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
              if (!res.ok) continue;
              const data = await res.json();

              if (data.latestPrice) {
                const current = data.latestPrice;
                const change = data.changePercent ? data.changePercent * 100 : null;

                const nameMap = {
                  'AAPL': 'Apple',
                  'AMZN': 'Amazon',
                  'TSLA': 'Tesla',
                  'MSFT': 'Microsoft'
                };
                results.push({
                  name: nameMap[symbol] || symbol,
                  price: current,
                  changePercent: change
                });
              }
            } catch (e) {
              console.log(`IEX Cloud failed for ${symbol}:`, e);
              continue;
            }
          }

          if (results.length === 0) throw new Error('IEX Cloud failed');

          // Sort in desired order
          const order = ['Apple', 'Amazon', 'Tesla', 'Microsoft'];
          results.sort((a, b) => order.indexOf(a.name) - order.indexOf(b.name));

          return results;
        }
      ];

      let success = false;
      for (const [index, source] of dataSources.entries()) {
        try {
          console.log(`Trying real data source ${index + 1}...`);
          const rows = await source();
          if (rows && rows.length > 0) {
            render(rows);
            success = true;
            console.log(`Successfully loaded from data source ${index + 1}`);
            break;
          }
        } catch (err) {
          console.error(`Data source ${index + 1} failed:`, err);
          continue;
        }
      }

      if (!success) {
        console.error('All real data sources failed');
        el.innerHTML = '<div class="stock-row"><span class="stock-name">Stock data unavailable</span><span class="stock-value"></span><span class="stock-change"></span></div>';
      }

      // Manage interval based on market hours
      if (isMarketOpenNY()) {
        if (!stocksTimer) stocksTimer = setInterval(loadStocks, 5 * 60 * 1000);
      } else if (stocksTimer) {
        clearInterval(stocksTimer);
        stocksTimer = null;
      }
    }

    // ---- Sports (NY teams ordered) ----
    const TEAM_ORDER_PRIORITY = [
      'Mets','Knicks','Rangers','Yankees','Giants','Nets','NYCFC','Red Bulls','Liberty','Gotham FC'
    ];

    const ALLOW_BY_LEAGUE = {
      MLB: [
        { label: 'Mets',    rx: [/\bnew york mets\b/i, /\bmets\b/i, /\bNYM\b/i] },
        { label: 'Yankees', rx: [/\bnew york yankees\b/i, /\byankees\b/i, /\bNYY\b/i] },
      ],
      NBA: [
        { label: 'Knicks',  rx: [/\bnew york knicks\b/i, /\bknicks\b/i, /\bNYK\b/i] },
        { label: 'Nets',    rx: [/\bbrooklyn nets\b/i, /\bnets\b/i, /\bBKN\b/i] },
      ],
      NFL: [
        { label: 'Giants',  rx: [/\bnew york giants\b/i, /\bgiants\b/i, /\bNYG\b/i] },
      ],
      NHL: [
        { label: 'Rangers', rx: [/\bnew york rangers\b/i, /\brangers\b/i, /\bNYR\b/i] },
      ],
      MLS: [
        { label: 'NYCFC',     rx: [/\bnycfc\b/i, /\bnew york city fc\b/i] },
        { label: 'Red Bulls', rx: [/\bnew york red bulls\b/i, /\bred bulls\b/i, /\bNYRB\b/i] },
      ],
      WNBA: [
        { label: 'Liberty', rx: [/\bnew york liberty\b/i, /\bliberty\b/i, /\bNYL\b/i] },
      ],
      NWSL: [
        { label: 'Gotham FC', rx: [/\bgotham fc\b/i, /\bgotham\b/i, /nj\/ny/i, /\bNJNY\b/i] },
      ],
    };

    const LEAGUES = [
      { key:'MLB',   path:'baseball/mlb' },
      { key:'NBA',   path:'basketball/nba' },
      { key:'NFL',   path:'football/nfl' },
      { key:'NHL',   path:'hockey/nhl' },
      { key:'MLS',   path:'soccer/usa.1' },
      { key:'WNBA',  path:'basketball/wnba' },
      { key:'NWSL',  path:'soccer/usa.nwsl' },
    ];

    function teamString(t) {
      const parts = [
        t?.team?.displayName, t?.team?.shortDisplayName, t?.team?.name,
        t?.team?.abbreviation, t?.team?.location, t?.team?.nickname
      ].filter(Boolean);
      return parts.join(' ').toLowerCase();
    }

    function matchLocalLabelForLeague(teamObj, leagueKey) {
      const s = teamString(teamObj);
      const allow = ALLOW_BY_LEAGUE[leagueKey] || [];
      for (const entry of allow) {
        if (entry.rx.some(r => r.test(s))) return entry.label;
      }
      return null;
    }

    function bestLocalLabelForEvent(ev, leagueKey) {
      const teams = ev.competitions?.[0]?.competitors || [];
      const labels = teams.map(t => matchLocalLabelForLeague(t, leagueKey)).filter(Boolean);
      if (!labels.length) return null;
      labels.sort((a, b) => {
        const ia = TEAM_ORDER_PRIORITY.indexOf(a);
        const ib = TEAM_ORDER_PRIORITY.indexOf(b);
        return (ia === -1 ? 999 : ia) - (ib === -1 ? 999 : ib);
      });
      return labels[0];
    }

    function eventHasScore(ev) {
      const comps = ev.competitions?.[0]?.competitors || [];
      return comps.some(t => t && t.score !== undefined && t.score !== null && t.score !== '');
    }

    function getRecordSummary(competitor) {
      if (Array.isArray(competitor?.records) && competitor.records.length) {
        const overall = competitor.records.find(r => /overall/i.test(r.name)) || competitor.records[0];
        if (overall?.summary) return overall.summary;
      }
      if (competitor?.record && typeof competitor.record === 'string') return competitor.record;
      if (competitor?.team?.record && typeof competitor.team.record === 'string') return competitor.team.record;
      return '';
    }

    function formatStatus(ev) {
      const comp = ev.competitions?.[0];
      const st = comp?.status?.type;
      if (!st) return '‚Äî';
      if (st.state === 'pre') {
        const t = comp.date ? new Date(comp.date) : null;
        return t ? t.toLocaleTimeString([], { hour:'numeric', minute:'2-digit' }) : (st.shortDetail || 'Scheduled');
      }
      if (st.state === 'in')  return st.shortDetail || 'Live';
      if (st.state === 'post') return st.shortDetail || 'Final';
      return st.shortDetail || '‚Äî';
    }

    async function fetchLeague(leaguePath, dateStr) {
      const url = `https://site.api.espn.com/apis/site/v2/sports/${leaguePath}/scoreboard?dates=${dateStr}`;
      const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
      if (!res.ok) throw new Error(`ESPN ${leaguePath} failed`);
      return res.json();
    }

    // ---------- BUILD (initial) ----------
    function renderGamesInto(container, leagueLabel, events) {
      if (!events.length) return;
      const block = document.createElement('div');
      block.className = 'league-block';

      const title = document.createElement('div');
      title.className = 'league-name';
      title.textContent = leagueLabel;
      block.appendChild(title);

      for (const ev of events) {
        const comp = ev.competitions?.[0];
        const teams = comp?.competitors || [];
        theAway = teams.find(t => t.homeAway === 'away');
        theHome = teams.find(t => t.homeAway === 'home');

        const away = theAway || {};
        const home = theHome || {};

        const awayName  = away?.team?.shortDisplayName || away?.team?.displayName || 'Away';
        const homeName  = home?.team?.shortDisplayName || home?.team?.displayName || 'Home';
        const awayScore = away?.score ?? '';
        const homeScore = home?.score ?? '';

        const awayRec = getRecordSummary(away);
        const homeRec = getRecordSummary(home);

        const statusText = formatStatus(ev);
        const isLive = (comp?.status?.type?.state === 'in');

        const line = document.createElement('div');
        line.className = 'game-line' + (isLive ? ' live' : '');
        line.setAttribute('data-event-id', ev.id);

        line.innerHTML = `
          <div class="game-left">
            <div class="team-col">
              <div class="team-main">${awayName} - <span class="score" id="score-${ev.id}-away" data-event-id="${ev.id}" data-side="away">${awayScore}</span></div>
              ${awayRec ? `<div class="team-sub">(${awayRec})</div>` : ''}
            </div>
            <span class="at">@</span>
            <div class="team-col">
              <div class="team-main">${homeName} - <span class="score" id="score-${ev.id}-home" data-event-id="${ev.id}" data-side="home">${homeScore}</span></div>
              ${homeRec ? `<div class="team-sub">(${homeRec})</div>` : ''}
            </div>
          </div>
          <div class="game-status" id="status-${ev.id}">${statusText}</div>
        `;
        block.appendChild(line);
      }

      container.appendChild(block);
    }

    async function buildSportsScores() {
      try {
        const scoresContainer = document.getElementById('sports-scores');
        if (!scoresContainer) return;

        scoresContainer.innerHTML = `
          <div class="sports-title">Today's NY Scores (${new Date().toLocaleDateString([], {weekday:'short', month:'short', day:'numeric'})})</div>
          <div class="scores-scroll" id="scores-scroll"></div>
        `;
        const scrollHost = document.getElementById('scores-scroll');
        const dateStr = yyyymmdd(new Date());
        let hasLiveOverall = false;

        for (const lg of LEAGUES) {
          try {
            const data = await fetchLeague(lg.path, dateStr);

            let nyEvents = (data.events || []).map(ev => {
              ev.__localLabel = bestLocalLabelForEvent(ev, lg.key);
              return ev;
            }).filter(ev => ev.__localLabel);

            // Scored games first, then by your order, then by start time
            nyEvents.sort((a, b) => {
              const as = eventHasScore(a), bs = eventHasScore(b);
              if (as !== bs) return bs - as;
              const ia = TEAM_ORDER_PRIORITY.indexOf(a.__localLabel);
              const ib = TEAM_ORDER_PRIORITY.indexOf(b.__localLabel);
              const pa = ia === -1 ? 999 : ia;
              const pb = ib === -1 ? 999 : ib;
              if (pa !== pb) return pa - pb;
              const ta = new Date(a.competitions?.[0]?.date || 0).getTime();
              const tb = new Date(b.competitions?.[0]?.date || 0).getTime();
              return ta - tb;
            });

            if (nyEvents.some(ev => ev.competitions?.[0]?.status?.type?.state === 'in')) {
              hasLiveOverall = true;
            }

            const temp = document.createElement('div');
            renderGamesInto(temp, lg.key, nyEvents);
            if (temp.firstChild) scrollHost.appendChild(temp.firstChild);

          } catch (err) {
            console.error('League build error', lg.key, err);
            const block = document.createElement('div');
            block.className = 'league-block';
            block.innerHTML = `<div class="league-name">${lg.key}</div><div class="game-line"><span class="game-left">Scores unavailable</span></div>`;
            scrollHost.appendChild(block);
          }
        }

        // Set up/tear down interval based on live games
        manageScoresInterval(hasLiveOverall);
      } catch (e) {
        console.error('buildSportsScores error', e);
        const scoresContainer = document.getElementById('sports-scores');
        if (scoresContainer) scoresContainer.innerHTML = '<div class="sports-title">Scores unavailable</div>';
      }
    }

    // ---------- REFRESH (scores only) ----------
    let scoresRefreshTimer = null;
    let refreshing = false;

    function manageScoresInterval(hasLive) {
      if (hasLive && !scoresRefreshTimer) {
        scoresRefreshTimer = setInterval(refreshScoresOnly, 30000); // 30s
      } else if (!hasLive && scoresRefreshTimer) {
        clearInterval(scoresRefreshTimer);
        scoresRefreshTimer = null;
      }
    }

    async function refreshScoresOnly() {
      if (refreshing) return;
      refreshing = true;

      try {
        const dateStr = yyyymmdd(new Date());
        let hasLiveOverall = false;

        for (const lg of LEAGUES) {
          try {
            const data = await fetchLeague(lg.path, dateStr);
            let nyEvents = (data.events || []).map(ev => {
              ev.__localLabel = bestLocalLabelForEvent(ev, lg.key);
              return ev;
            }).filter(ev => ev.__localLabel);

            if (nyEvents.some(ev => ev.competitions?.[0]?.status?.type?.state === 'in')) {
              hasLiveOverall = true;
            }

            // Update only existing nodes
            nyEvents.forEach(ev => {
              const comp = ev.competitions?.[0];
              const teams = comp?.competitors || [];
              const away = teams.find(t => t.homeAway === 'away');
              const home = teams.find(t => t.homeAway === 'home');
              const awayScore = (away?.score ?? '').toString();
              const homeScore = (home?.score ?? '').toString();

              // Scores
              const awayEl = document.getElementById(`score-${ev.id}-away`);
              const homeEl = document.getElementById(`score-${ev.id}-home`);
              if (awayEl && awayEl.textContent !== awayScore) {
                awayEl.classList.add('score-updating');
                void awayEl.offsetWidth;
                awayEl.textContent = awayScore;
                setTimeout(() => awayEl.classList.remove('score-updating'), 180);
              }
              if (homeEl && homeEl.textContent !== homeScore) {
                homeEl.classList.add('score-updating');
                void homeEl.offsetWidth;
                homeEl.textContent = homeScore;
                setTimeout(() => homeEl.classList.remove('score-updating'), 180);
              }

              // Live class + status text
              const line = document.querySelector(`.game-line[data-event-id="${ev.id}"]`);
              if (line) {
                const isLive = (comp?.status?.type?.state === 'in');
                line.classList.toggle('live', !!isLive);

                const statusEl = document.getElementById(`status-${ev.id}`);
                if (statusEl) {
                  const statusText = (function(){
                    const st = comp?.status?.type;
                    if (!st) return '‚Äî';
                    if (st.state === 'pre') {
                      const t = comp.date ? new Date(comp.date) : null;
                      return t ? t.toLocaleTimeString([], { hour:'numeric', minute:'2-digit' }) : (st.shortDetail || 'Scheduled');
                    }
                    if (st.state === 'in')  return st.shortDetail || 'Live';
                    if (st.state === 'post') return st.shortDetail || 'Final';
                    return st.shortDetail || '‚Äî';
                  })();
                  if (statusEl.textContent !== statusText) statusEl.textContent = statusText;
                }
              }
            });

          } catch (e) {
            console.error('Refresh error for league', lg.key, e);
          }
        }

        manageScoresInterval(hasLiveOverall);
      } finally {
        refreshing = false;
      }
    }

    // ========= Video lists =========
    var xmas_videos = [
      { id: 'rgEP1niScLc', title: 'Christmas Music' },
      { id: 'S7OWoc-j8qQ', title: 'Holiday Cheer' },
      { id: 'hZ9q3PtiYu8', title: 'Festive Fun' },
      { id: 'E3RQVcNUcTA', title: 'Christmas Spirit' },
      { id: 'GPG3zSgm_Qo', title: 'Holiday Joy' },
      { id: 'tR_Z1LUDQuQ', title: 'Winter Wonderland' },
      { id: 'kSkyv8EUEsU', title: 'Christmas Magic' },
      { id: 'uIsgSQvsRj8', title: 'Holiday Memories' },
      { id: 'e-r8hvTFVb8', title: 'Christmas Time' },
      { id: 'myzC3f0j9kw', title: 'Seasonal Celebration' },
      { id: 'LznVSn7Ud9o', title: 'Christmas Classic' }
    ];
    var american_holiday_videos = [
      { id: 'dJxj1mou03M', title: 'American Pride' },
      { id: '4GJArpnLqGY', title: 'Patriotic Spirit' },
      { id: 'U1mlCPMYtPk', title: 'Land of the Free' },
      { id: 'N_lCmBvYMRs', title: 'Stars and Stripes' }
    ];
    var regular_videos = [
      { id: 'CMNry4PE93Y', title: 'Classic Hit' },
      { id: 'dQw4w9WgXcQ', title: 'Never Gonna Give You Up' },
      { id: '6GsCmnZnllk', title: 'Music Video' },
      { id: 'kR2O_xuVvIU', title: 'Popular Song' },
      { id: '1VbZE6YhjKk', title: 'Hit Single' },
      { id: 'ohz8_IafGwE', title: 'Chart Topper' },
      { id: 'S2XvxDaIwCw', title: 'Music Classic' },
      { id: '7wrw19K_g_M', title: 'Fan Favorite' },
      { id: 'TkyLnWm1iCs', title: 'Trending Video' },
      { id: '5ztwns5PkJY', title: 'Viral Hit' },
      { id: 'GV01B5kVsC0', title: 'Popular Choice' },
      { id: 'rzQAC8kPJxo', title: 'Music Selection' },
      { id: '7ujwjqIldwU', title: 'Entertainment' },
      { id: '5UDoSc-fRpg', title: 'Video Pick' },
      { id: 'pCTfxOrX4k8', title: 'Featured Content' },
      { id: 'Dr0m5bWAgk0', title: 'Recommended' },
      { id: 'lMDkxFnUTZs', title: 'Top Selection' },
      { id: 'voDqfVthTpA', title: 'Must Watch' },
      { id: 'y8p1iG-6d-w', title: 'Video Feature' },
      { id: '-riX6Xbvb8w', title: 'Entertainment Pick' },
      { id: 'Abr_LU822rQ', title: 'Featured Video' },
      { id: '9m_12SGXNKw', title: 'Popular Content' },
      { id: 'JJmqCKtJnxM', title: 'Video Choice' },
      { id: 'NZJrGuC92U8', title: 'Entertainment Value' },
      { id: 'sZywE0AT1qY', title: 'Viewer Favorite' },
      { id: '3O0ptHIh6Yo', title: 'Quality Content' },
      { id: 'KoPFkjF-Bdo', title: 'Video Experience' },
      { id: 'c1EyN9xTK94', title: 'Entertainment Gold' },
      { id: 'ODmhPsgqGgQ', title: 'Premium Pick' }
    ];

    function pickVideoList() {
      const now = new Date();
      if (now.getMonth() == 11) {
        if (now.getDate() == 25) return [{ id: 'DtrIWQ8J9jw', title: 'Christmas Day Special' }];
        return xmas_videos;
      } else if (now.getMonth() == 6 && now.getDate() == 4) {
        return american_holiday_videos;
      } else if (now.getMonth() == 4 && now.getDate() >= 25 && now.getDate() <= 31) {
        return american_holiday_videos;
      } else if (now.getMonth() == 1 && now.getDate() >= 12 && now.getDate() <= 22) {
        return american_holiday_videos;
      } else if (now.getMonth() == 8 && now.getDate() >= 1 && now.getDate() <= 7) {
        return american_holiday_videos;
      } else if (now.getMonth() == 10 && now.getDate() == 11) {
        return american_holiday_videos;
      } else if (now.getMonth() == 9 && now.getDate() <= 31 && now.getDate() >= 17) {
        return [{ id: 'xiSIQzwIPzQ', title: 'Halloween Special' }];
      } else if (now.getMonth() == 0 && now.getDate() == 1) {
        return [{ id: 'vdLuk2Agamk', title: 'New Year Celebration' }];
      } else if (now.getMonth() == 10 && now.getDate() <= 31 && now.getDate() >= 17) {
        return [{ id: 'AORGKS6y_qI', title: 'Thanksgiving Special' }];
      } else {
        return regular_videos;
      }
    }

    function loadRandomVideo() {
      const list = pickVideoList();
      const index = Math.floor(Math.random() * list.length);
      const video = list[index];
      const html = '<iframe src="https://www.youtube.com/embed/' + video.id + '?autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
      const slot = document.querySelector('.video');
      const titleElement = document.getElementById('video-title');

      if (slot) slot.innerHTML = html;
      if (titleElement) titleElement.textContent = video.title;
    }

    // ---- Kick everything off safely (so one failure doesn't stop others) ----
    $(document).ready(function () {
      try { updateNYTime(); setInterval(updateNYTime, 1000 * 30); } catch(e){ console.error(e); }
      try { loadWeather(); } catch(e){ console.error(e); }
      try { loadBitcoinPrice(); } catch(e){ console.error(e); }
      try { loadStocks(); } catch(e){ console.error(e); }
      try { buildSportsScores(); } catch(e){ console.error(e); }
      try { loadRandomVideo(); } catch(e){ console.error(e); }
    });
  </script>
</head>

<body>
  <header class="fixed-header">
    <div class="site-title">JoeRod.com</div>
  </header>

  <div class="weather-widget">
    <div id="ny-time" class="ny-time">NYC ‚Ä¢ ‚Äî</div>

    <div id="weather-icon" class="weather-icon">üå§Ô∏è</div>
    <div id="weather-temp" class="weather-temp loading">Loading...</div>
    <div id="weather-desc" class="weather-desc loading">Getting weather...</div>

    <div class="bitcoin-price">
      <div class="bitcoin-price-title">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/bitcoin.svg" alt="Bitcoin">
        Bitcoin Price
      </div>
      <div id="bitcoin-price-value" class="bitcoin-price-value loading">Loading...</div>
    </div>

    <!-- Individual Stocks below Bitcoin -->
    <div class="stocks">
      <div class="stocks-title">
        <!-- $ icon as inline SVG so it always renders -->
        <svg class="icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path fill="currentColor" d="M7.25 1a.75.75 0 0 1 1.5 0v1.053c1.41.147 2.75.86 3.29 2.14a.75.75 0 1 1-1.381.58c-.3-.713-1.11-1.23-1.909-1.38v3.005c2.01.46 4.25 1.18 4.25 3.602 0 2.01-1.77 3.282-4.25 3.49V15a.75.75 0 0 1-1.5 0v-1.03c-1.8-.16-3.32-.99-3.93-2.38a.75.75 0 0 1 1.37-.61c.37.84 1.39 1.39 2.56 1.55V8.47C4.38 8.02 2.25 7.25 2.25 5.08c0-1.97 1.73-3.17 5-3.28V1Zm0 4.2c-1.71.1-2.5.67-2.5 1.37 0 .69.89 1.11 2.5 1.5V5.2Zm1.5 6.58c1.71-.12 2.75-.68 2.75-1.64 0-.86-.94-1.33-2.75-1.78v3.42Z"/>
        </svg>
        Stock Prices
      </div>
      <div id="stocks-body">
        <!-- Rows inserted here -->
      </div>
    </div>

    <div id="sports-scores" class="sports-scores">
      <div class="sports-title loading">Loading scores...</div>
    </div>
  </div>

  <main>
    <div class="video-controls">
      <a href="#" onclick="loadRandomVideo(); return false;">Next Video</a>
    </div>

    <div id="video-title" class="video-title">Loading video...</div>

    <div class="video-container">
      <div class="video"></div>
    </div>
  </main>

  <footer>
    <div class="social-links">
      <!-- ORDER: Twitter/X, Instagram, TikTok, Facebook, YouTube, Spotify, GitHub, LinkedIn -->
      <a href="https://x.com/joerodr" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter) @joerodr">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/x.svg" alt="X (Twitter)" />
        @joerodr
      </a>

      <a href="https://instagram.com/joerodr" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Instagram @joerodr">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/instagram.svg" alt="Instagram" />
        @joerodr
      </a>

      <a href="https://www.tiktok.com/@joerod45" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="TikTok @joerod45">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/tiktok.svg" alt="TikTok" />
        @joerod45
      </a>

      <a href="https://facebook.com/joerod" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Facebook joerod">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/facebook.svg" alt="Facebook" />
        joerod
      </a>

      <a href="https://www.youtube.com/@joerodr45" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="YouTube @joerodr45">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/youtube.svg" alt="YouTube" />
        @joerodr45
      </a>

      <a href="https://open.spotify.com/playlist/5OYeC1eQC0Zf925B1YXcBm?si=ecb7ab53786b4550" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Spotify Playlist">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/spotify.svg" alt="Spotify" />
        My Playlist
      </a>

      <a href="https://github.com/joerod" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="GitHub @joerod">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/github.svg" alt="GitHub" />
        @joerod
      </a>

      <a href="https://www.linkedin.com/in/joerodr/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/linkedin.svg" alt="LinkedIn" />
        LinkedIn
      </a>
    </div>
  </footer>
</body>
</html>
